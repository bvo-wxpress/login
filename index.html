<html lang="en" data-ember-extension="1">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="">
		<link rel="icon" href="http://bvo-wxpress3.s3-website-us-east-1.amazonaws.com/wp-content/uploads/2018/03/cropped-simple-blue-star-152-69157-192x192.png">
		<title>WxPress CPanel</title>
		<link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/signin/">
		<!-- Bootstrap core CSS -->
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">	<!-- Custom styles for this template -->
		<link href="https://v4-alpha.getbootstrap.com/examples/signin/signin.css" rel="stylesheet">
	</head>
	<body>
		<div class="container">
			<form class="form-signin" id="cognito-signin">
				<h2 class="form-signin-heading">Please sign in</h2>
				<label for="inputEmail" class="sr-only">Email address</label>
				<input value="vo.bee92@gmail.com" name="email" type="email" id="inputEmail" class="form-control" placeholder="Email address" required="" autofocus="">
				<label for="inputPassword" class="sr-only">Password</label>
				<input value="222222" name="password" type="password" id="inputPassword" class="form-control" placeholder="Password" required="">
				<div class="checkbox">
					<label>
					<input type="checkbox" value="remember-me"> Remember me
					</label>
				</div>
				<button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>
			</form>
		</div>
    <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> -->
	</body>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.92.0.min.js"></script>
	<script src="amazon-cognito-identity.min.js"></script>
  <script type="text/javascript">
  	// Configure AWS SDK for JavaScript & set region and credentials
    // Initialize the Amazon Cognito credentials provider
		var region = 'us-east-1';


		function cognitoAuth(email,password){
			var authenticationData = {
				Username : email,
				Password : password,
			};
			var identityPoolId = 'us-east-1:12bfad04-4796-41c9-a67a-e9537d0d4c1a';
			var clientId = 'jrehfd9bq6br71ge4ao07hrfd';
			var userPoolId = 'us-east-1_2cpDG6O0l';

			var CognitoUserPool = AmazonCognitoIdentity.CognitoUserPool;
			var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
			var poolData = {
					UserPoolId : userPoolId, // Your user pool id here
					ClientId : clientId // Your client id here
			};
			var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
			var userData = {
					Username : authenticationData.Username,
					Pool : userPool
			};
			var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
			cognitoUser.authenticateUser(authenticationDetails, {
				onSuccess: function (result) {
					console.log(result);
					console.log(result.idToken.jwtToken);
					console.log("About to do some API CALLS");
					var apiUrl = "https://hzbpkjmkte.execute-api.us-east-1.amazonaws.com/prod/";
					var xhttp = new XMLHttpRequest();
					console.log(xhttp);

					xhttp.open('POST',apiUrl, true);
					xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
					xhttp.setRequestHeader("Authorization", result.idToken.jwtToken);
					xhttp.send();
					xhttp.onreadystatechange = function() {
						if (xhttp.readyState == XMLHttpRequest.DONE) {
							var response = JSON.parse(xhttp.responseText);
							console.log(response);
							if (response.public_dns) {
								if (confirm("Instance Started. Ready to go to WP-Admin?")) {
									window.location.href = "http://"+response.public_dns;
								}else{
									
									window.location.reload();
								}
								return;
							}else{
								alert("No public dns was found!");
							}
						}else{
							console.log(xhttp.readyState);
						}
					}
					return;
				},
				newPasswordRequired: function(userAttributes, requiredAttributes) {
					alert("User needs new password. Defaulting to 222222");
					cognitoUser.completeNewPasswordChallenge('222222', {}, this);
				},
				onFailure: function(err) {
					// alert("error check console");
					if (err.message) {
						alert("fail... "+err.message);
					}
				},
			});
		}
    var form = document.getElementById('cognito-signin');
    form.addEventListener('submit',function(event){
      event.preventDefault();
      var data = new FormData(form);
      var email = data.get('email');
      var password = data.get('password');
      cognitoAuth(email,password);
    });
  </script>
</html>
